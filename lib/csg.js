export default function CSG(){this.polygons=[]}CSG.fromPolygons=function(n){var t=new CSG;return t.polygons=n,t},CSG.prototype={clone:function(){var n=new CSG;return n.polygons=this.polygons.map((function(n){return n.clone()})),n},toPolygons:function(){return this.polygons},union:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.clipTo(o),o.clipTo(t),o.invert(),o.clipTo(t),o.invert(),t.build(o.allPolygons()),CSG.fromPolygons(t.allPolygons())},subtract:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.invert(),t.clipTo(o),o.clipTo(t),o.invert(),o.clipTo(t),o.invert(),t.build(o.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},intersect:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.invert(),o.clipTo(t),o.invert(),t.clipTo(o),o.clipTo(t),t.build(o.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},inverse:function(){var n=this.clone();return n.polygons.map((function(n){n.flip()})),n}},CSG.cube=function(n){n=n||{};var t=new CSG.Vector(n.center||[0,0,0]),o=n.radius?n.radius.length?n.radius:[n.radius,n.radius,n.radius]:[1,1,1];return CSG.fromPolygons([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map((function(n){return new CSG.Polygon(n[0].map((function(i){var e=new CSG.Vector(t.x+o[0]*(2*!!(1&i)-1),t.y+o[1]*(2*!!(2&i)-1),t.z+o[2]*(2*!!(4&i)-1));return new CSG.Vertex(e,new CSG.Vector(n[1]))})))})))},CSG.sphere=function(n){n=n||{};var t,o=new CSG.Vector(n.center||[0,0,0]),i=n.radius||1,e=n.slices||16,s=n.stacks||8,r=[];function l(n,e){n*=2*Math.PI,e*=Math.PI;var s=new CSG.Vector(Math.cos(n)*Math.sin(e),Math.cos(e),Math.sin(n)*Math.sin(e));t.push(new CSG.Vertex(o.plus(s.times(i)),s))}for(var h=0;h<e;h++)for(var c=0;c<s;c++)t=[],l(h/e,c/s),c>0&&l((h+1)/e,c/s),c<s-1&&l((h+1)/e,(c+1)/s),l(h/e,(c+1)/s),r.push(new CSG.Polygon(t));return CSG.fromPolygons(r)},CSG.cylinder=function(n){n=n||{};var t=new CSG.Vector(n.start||[0,-1,0]),o=new CSG.Vector(n.end||[0,1,0]),i=o.minus(t),e=n.radius||1,s=n.slices||16,r=i.unit(),l=Math.abs(r.y)>.5,h=new CSG.Vector(l,!l,0).cross(r).unit(),c=h.cross(r).unit(),u=new CSG.Vertex(t,r.negated()),a=new CSG.Vertex(o,r.unit()),p=[];function f(n,o,s){var l=o*Math.PI*2,u=h.times(Math.cos(l)).plus(c.times(Math.sin(l))),a=t.plus(i.times(n)).plus(u.times(e)),p=u.times(1-Math.abs(s)).plus(r.times(s));return new CSG.Vertex(a,p)}for(var y=0;y<s;y++){var S=y/s,g=(y+1)/s;p.push(new CSG.Polygon([u,f(0,S,-1),f(0,g,-1)])),p.push(new CSG.Polygon([f(0,g,0),f(0,S,0),f(1,S,0),f(1,g,0)])),p.push(new CSG.Polygon([a,f(1,g,1),f(1,S,1)]))}return CSG.fromPolygons(p)},CSG.Vector=function(n,t,o){3==arguments.length?(this.x=n,this.y=t,this.z=o):"x"in n?(this.x=n.x,this.y=n.y,this.z=n.z):(this.x=n[0],this.y=n[1],this.z=n[2])},CSG.Vector.prototype={clone:function(){return new CSG.Vector(this.x,this.y,this.z)},negated:function(){return new CSG.Vector(-this.x,-this.y,-this.z)},plus:function(n){return new CSG.Vector(this.x+n.x,this.y+n.y,this.z+n.z)},minus:function(n){return new CSG.Vector(this.x-n.x,this.y-n.y,this.z-n.z)},times:function(n){return new CSG.Vector(this.x*n,this.y*n,this.z*n)},dividedBy:function(n){return new CSG.Vector(this.x/n,this.y/n,this.z/n)},dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},lerp:function(n,t){return this.plus(n.minus(this).times(t))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(n){return new CSG.Vector(this.y*n.z-this.z*n.y,this.z*n.x-this.x*n.z,this.x*n.y-this.y*n.x)}},CSG.Vertex=function(n,t,o,i){this.pos=new CSG.Vector(n),this.normal=new CSG.Vector(t),this.uv=o&&o.clone(),this.color=i&&new CSG.Vector(i)},CSG.Vertex.prototype={clone:function(){return new CSG.Vertex(this.pos.clone(),this.normal.clone(),this.uv&&this.uv.clone(),this.color&&this.color.clone())},flip:function(){this.normal=this.normal.negated()},interpolate:function(n,t){return new CSG.Vertex(this.pos.lerp(n.pos,t),this.normal.lerp(n.normal,t),this.uv&&n.uv&&this.uv.lerp(n.uv,t),this.color&&n.color&&this.color.lerp(n.color,t))}},CSG.Plane=function(n,t){this.normal=n,this.w=t},CSG.Plane.EPSILON=1e-5,CSG.Plane.fromPoints=function(n,t,o){var i=t.minus(n).cross(o.minus(n)).unit();return new CSG.Plane(i,i.dot(n))},CSG.Plane.prototype={clone:function(){return new CSG.Plane(this.normal.clone(),this.w)},flip:function(){this.normal=this.normal.negated(),this.w=-this.w},splitPolygon:function(n,t,o,i,e){for(var s=0,r=[],l=0;l<n.vertices.length;l++){var h=(g=this.normal.dot(n.vertices[l].pos)-this.w)<-CSG.Plane.EPSILON?2:g>CSG.Plane.EPSILON?1:0;s|=h,r.push(h)}switch(s){case 0:(this.normal.dot(n.plane.normal)>0?t:o).push(n);break;case 1:i.push(n);break;case 2:e.push(n);break;case 3:var c=[],u=[];for(l=0;l<n.vertices.length;l++){var a=(l+1)%n.vertices.length,p=r[l],f=r[a],y=n.vertices[l],S=n.vertices[a];if(2!=p&&c.push(y),1!=p&&u.push(2!=p?y.clone():y),3==(p|f)){var g=(this.w-this.normal.dot(y.pos))/this.normal.dot(S.pos.minus(y.pos)),C=y.interpolate(S,g);c.push(C),u.push(C.clone())}}c.length>=3&&i.push(new CSG.Polygon(c,n.shared)),u.length>=3&&e.push(new CSG.Polygon(u,n.shared))}}},CSG.Polygon=function(n,t){this.vertices=n,this.shared=t,this.plane=CSG.Plane.fromPoints(n[0].pos,n[1].pos,n[2].pos)},CSG.Polygon.prototype={clone:function(){var n=this.vertices.map((function(n){return n.clone()}));return new CSG.Polygon(n,this.shared)},flip:function(){this.vertices.reverse().map((function(n){n.flip()})),this.plane.flip()}},CSG.Node=function(n){this.plane=null,this.front=null,this.back=null,this.polygons=[],n&&this.build(n)},CSG.Node.prototype={clone:function(){var n=new CSG.Node;return n.plane=this.plane&&this.plane.clone(),n.front=this.front&&this.front.clone(),n.back=this.back&&this.back.clone(),n.polygons=this.polygons.map((function(n){return n.clone()})),n},invert:function(){for(var n=0;n<this.polygons.length;n++)this.polygons[n].flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},clipPolygons:function(n){if(!this.plane)return n.slice();for(var t=[],o=[],i=0;i<n.length;i++)this.plane.splitPolygon(n[i],t,o,t,o);return this.front&&(t=this.front.clipPolygons(t)),o=this.back?this.back.clipPolygons(o):[],t.concat(o)},clipTo:function(n){this.polygons=n.clipPolygons(this.polygons),this.front&&this.front.clipTo(n),this.back&&this.back.clipTo(n)},allPolygons:function(){var n=this.polygons.slice();return this.front&&(n=n.concat(this.front.allPolygons())),this.back&&(n=n.concat(this.back.allPolygons())),n},build:function(n){if(n.length){this.plane||(this.plane=n[0].plane.clone());for(var t=[],o=[],i=0;i<n.length;i++)this.plane.splitPolygon(n[i],this.polygons,this.polygons,t,o);t.length&&(this.front||(this.front=new CSG.Node),this.front.build(t)),o.length&&(this.back||(this.back=new CSG.Node),this.back.build(o))}}};
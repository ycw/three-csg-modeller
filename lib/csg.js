export default function CSG(){this.polygons=[]}CSG.fromPolygons=function(n){var t=new CSG;return t.polygons=n,t},CSG.prototype={clone:function(){var n=new CSG;return n.polygons=this.polygons.map((function(n){return n.clone()})),n},toPolygons:function(){return this.polygons},union:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.clipTo(o),o.clipTo(t),o.invert(),o.clipTo(t),o.invert(),t.build(o.allPolygons()),CSG.fromPolygons(t.allPolygons())},subtract:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.invert(),t.clipTo(o),o.clipTo(t),o.invert(),o.clipTo(t),o.invert(),t.build(o.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},intersect:function(n){var t=new CSG.Node(this.clone().polygons),o=new CSG.Node(n.clone().polygons);return t.invert(),o.clipTo(t),o.invert(),t.clipTo(o),o.clipTo(t),t.build(o.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},inverse:function(){var n=this.clone();return n.polygons.map((function(n){n.flip()})),n}},CSG.Vector=function(n,t,o){3==arguments.length?(this.x=n,this.y=t,this.z=o):"x"in n?(this.x=n.x,this.y=n.y,this.z=n.z):(this.x=n[0],this.y=n[1],this.z=n[2])},CSG.Vector.prototype={clone:function(){return new CSG.Vector(this.x,this.y,this.z)},negated:function(){return new CSG.Vector(-this.x,-this.y,-this.z)},plus:function(n){return new CSG.Vector(this.x+n.x,this.y+n.y,this.z+n.z)},minus:function(n){return new CSG.Vector(this.x-n.x,this.y-n.y,this.z-n.z)},times:function(n){return new CSG.Vector(this.x*n,this.y*n,this.z*n)},dividedBy:function(n){return new CSG.Vector(this.x/n,this.y/n,this.z/n)},dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},lerp:function(n,t){return this.plus(n.minus(this).times(t))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(n){return new CSG.Vector(this.y*n.z-this.z*n.y,this.z*n.x-this.x*n.z,this.x*n.y-this.y*n.x)}},CSG.Vertex=function(n,t,o,i){this.pos=new CSG.Vector(n),this.normal=new CSG.Vector(t),this.uv=o&&o.clone(),this.color=i&&new CSG.Vector(i)},CSG.Vertex.prototype={clone:function(){return new CSG.Vertex(this.pos.clone(),this.normal.clone(),this.uv&&this.uv.clone(),this.color&&this.color.clone())},flip:function(){this.normal=this.normal.negated()},interpolate:function(n,t){return new CSG.Vertex(this.pos.lerp(n.pos,t),this.normal.lerp(n.normal,t),this.uv&&n.uv&&this.uv.clone().lerp(n.uv,t),this.color&&n.color&&this.color.lerp(n.color,t))}},CSG.Plane=function(n,t){this.normal=n,this.w=t},CSG.Plane.EPSILON=1e-5,CSG.Plane.fromPoints=function(n,t,o){var i=t.minus(n).cross(o.minus(n)).unit();return new CSG.Plane(i,i.dot(n))},CSG.Plane.prototype={clone:function(){return new CSG.Plane(this.normal.clone(),this.w)},flip:function(){this.normal=this.normal.negated(),this.w=-this.w},splitPolygon:function(n,t,o,i,s){for(var e=0,l=[],r=0;r<n.vertices.length;r++){var h=(S=this.normal.dot(n.vertices[r].pos)-this.w)<-CSG.Plane.EPSILON?2:S>CSG.Plane.EPSILON?1:0;e|=h,l.push(h)}switch(e){case 0:(this.normal.dot(n.plane.normal)>0?t:o).push(n);break;case 1:i.push(n);break;case 2:s.push(n);break;case 3:var c=[],u=[];for(r=0;r<n.vertices.length;r++){var p=(r+1)%n.vertices.length,a=l[r],f=l[p],y=n.vertices[r],g=n.vertices[p];if(2!=a&&c.push(y),1!=a&&u.push(2!=a?y.clone():y),3==(a|f)){var S=(this.w-this.normal.dot(y.pos))/this.normal.dot(g.pos.minus(y.pos)),v=y.interpolate(g,S);c.push(v),u.push(v.clone())}}c.length>=3&&i.push(new CSG.Polygon(c,n.shared)),u.length>=3&&s.push(new CSG.Polygon(u,n.shared))}}},CSG.Polygon=function(n,t){this.vertices=n,this.shared=t,this.plane=CSG.Plane.fromPoints(n[0].pos,n[1].pos,n[2].pos)},CSG.Polygon.prototype={clone:function(){var n=this.vertices.map((function(n){return n.clone()}));return new CSG.Polygon(n,this.shared)},flip:function(){this.vertices.reverse().map((function(n){n.flip()})),this.plane.flip()}},CSG.Node=function(n){this.plane=null,this.front=null,this.back=null,this.polygons=[],n&&this.build(n)},CSG.Node.prototype={clone:function(){var n=new CSG.Node;return n.plane=this.plane&&this.plane.clone(),n.front=this.front&&this.front.clone(),n.back=this.back&&this.back.clone(),n.polygons=this.polygons.map((function(n){return n.clone()})),n},invert:function(){for(var n=0;n<this.polygons.length;n++)this.polygons[n].flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},clipPolygons:function(n){if(!this.plane)return n.slice();for(var t=[],o=[],i=0;i<n.length;i++)this.plane.splitPolygon(n[i],t,o,t,o);return this.front&&(t=this.front.clipPolygons(t)),o=this.back?this.back.clipPolygons(o):[],t.concat(o)},clipTo:function(n){this.polygons=n.clipPolygons(this.polygons),this.front&&this.front.clipTo(n),this.back&&this.back.clipTo(n)},allPolygons:function(){var n=this.polygons.slice();return this.front&&(n=n.concat(this.front.allPolygons())),this.back&&(n=n.concat(this.back.allPolygons())),n},build:function(n){if(n.length){this.plane||(this.plane=n[0].plane.clone());for(var t=[],o=[],i=0;i<n.length;i++)this.plane.splitPolygon(n[i],this.polygons,this.polygons,t,o);t.length&&(this.front||(this.front=new CSG.Node),this.front.build(t)),o.length&&(this.back||(this.back=new CSG.Node),this.back.build(o))}}};
//# sourceMappingURL=true